<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Returns & Refunds | Britium Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Jost:wght@300;400;500;600&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  
  <style>
    /* --- RESET & VARIABLES --- */
    :root {
      --bg-dark: #141414;
      --bg-light: #f4f6f8;
      --white: #ffffff;
      --text-dark: #333333;
      --text-grey: #6b7280;
      --border-color: #e5e7eb;
      --primary-gold: #c6a87c;
      --primary-blue: #1a1a1a; 
      --status-green-bg: #dcfce7; --status-green-text: #166534;
      --status-red-bg: #fee2e2; --status-red-text: #991b1b;
      --status-yellow-bg: #fef3c7; --status-yellow-text: #92400e;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--bg-light);
      color: var(--text-dark);
      display: flex;
    }

    /* --- SIDEBAR --- */
    .sidebar { width: 260px; background: var(--bg-dark); color: #fff; height: 100vh; position: fixed; left: 0; top: 0; padding: 25px; box-sizing: border-box; display: flex; flex-direction: column; z-index: 100; }
    .sidebar h2 { color: var(--primary-gold); text-align: center; margin-bottom: 40px; font-family: 'Jost', sans-serif; letter-spacing: 1px; }
    .nav-link { display: flex; align-items: center; gap: 10px; padding: 12px 15px; color: #aaa; text-decoration: none; margin-bottom: 5px; border-radius: 8px; transition: 0.2s; font-size: 0.95rem; }
    .nav-link:hover, .nav-link.active { background: #333; color: #fff; }
    .nav-link.active { border-left: 3px solid var(--primary-gold); }
    .mt-auto { margin-top: auto; }

    /* --- MAIN CONTENT --- */
    main.content-area { margin-left: 260px; padding: 40px; width: 100%; min-height: 100vh; }

    .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
    .page-title { font-family: 'Jost', sans-serif; font-size: 1.8rem; font-weight: 600; color: #111; }

    /* --- FILTERS --- */
    .filters-bar { display: flex; gap: 20px; margin-bottom: 20px; }
    .search-wrapper { position: relative; flex: 1; max-width: 400px; }
    .search-input { width: 100%; padding: 10px 15px; border: 1px solid var(--border-color); border-radius: 6px; outline: none; }
    .filter-select { padding: 10px 15px; border: 1px solid var(--border-color); border-radius: 6px; background: #fff; cursor: pointer; }

    /* --- TABLE --- */
    .table-card { background-color: var(--white); border-radius: 8px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); overflow: hidden; border: 1px solid var(--border-color); }
    table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
    thead { background-color: #f9fafb; border-bottom: 1px solid var(--border-color); }
    th { text-align: left; padding: 15px 20px; font-weight: 600; color: var(--text-grey); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; }
    td { padding: 15px 20px; border-bottom: 1px solid var(--border-color); vertical-align: middle; }

    /* Status Badges */
    .status-badge { padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; text-transform: capitalize; }
    .status-approved { background-color: var(--status-green-bg); color: var(--status-green-text); }
    .status-rejected { background-color: var(--status-red-bg); color: var(--status-red-text); }
    .status-pending { background-color: var(--status-yellow-bg); color: var(--status-yellow-text); }

    .action-btn { background: none; border: 1px solid #e5e7eb; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.85rem; color: #333; transition: 0.2s; }
    .action-btn:hover { background: #f3f4f6; color: var(--primary-gold); border-color: var(--primary-gold); }

    /* --- MODAL --- */
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000; }
    .modal { background: #fff; width: 500px; max-width: 90%; padding: 30px; border-radius: 12px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
    
    .detail-row { display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 0.9rem; }
    .detail-label { color: #666; }
    .detail-value { font-weight: 600; }
    
    .reason-box { background: #f9fafb; padding: 15px; border-radius: 8px; margin: 20px 0; border: 1px solid #eee; }
    .reason-title { font-size: 0.75rem; text-transform: uppercase; color: #888; margin-bottom: 5px; font-weight: 700; }
    
    .modal-actions { margin-top: 25px; display: flex; gap: 10px; }
    .btn-approve { flex: 1; background: var(--status-green-bg); color: var(--status-green-text); border: none; padding: 12px; border-radius: 6px; font-weight: 600; cursor: pointer; }
    .btn-reject { flex: 1; background: var(--status-red-bg); color: var(--status-red-text); border: none; padding: 12px; border-radius: 6px; font-weight: 600; cursor: pointer; }
    .btn-close { background: #fff; border: 1px solid #ccc; padding: 12px; border-radius: 6px; cursor: pointer; }

  </style>

  <script>
    const session = localStorage.getItem("britium_admin_session");
    if (!session) window.location.href = "../admin-login.html";
  </script>
</head>
<body>

  <aside class="sidebar">
    <h2>BRITIUM ADMIN</h2>
    <a href="../dashboard/index.html" class="nav-link"><span>üè†</span> Dashboard</a>
    <a href="orders.html" class="nav-link"><span>üì¶</span> Orders</a>
    <a href="products.html" class="nav-link"><span>üëú</span> Products</a>
    <a href="customers.html" class="nav-link"><span>üë§</span> Customers</a>
    <a href="returns.html" class="nav-link active"><span>‚Ü©Ô∏è</span> Returns</a>
    <a href="#" class="nav-link mt-auto" onclick="logout()"><span>üö™</span> Logout</a>
  </aside>

  <main class="content-area">
    
    <div class="page-header">
      <div>
        <h1 class="page-title">Return Requests</h1>
        <p style="color:#666; font-size:0.9rem; margin-top:5px;">Manage refunds and item returns</p>
      </div>
    </div>

    <div class="filters-bar">
      <div class="search-wrapper">
        <input type="text" id="searchInput" class="search-input" placeholder="Search ID, customer or product...">
      </div>
      <select id="statusFilter" class="filter-select" onchange="renderTable()">
        <option value="">All Statuses</option>
        <option value="Pending">Pending</option>
        <option value="Approved">Approved</option>
        <option value="Rejected">Rejected</option>
      </select>
    </div>

    <div class="table-card">
      <table>
        <thead>
          <tr>
            <th>Return ID</th>
            <th>Date</th>
            <th>Customer</th>
            <th>Product</th>
            <th>Amount</th>
            <th>Status</th>
            <th style="text-align:right">Actions</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          </tbody>
      </table>
    </div>
  </main>

  <div class="modal-overlay" id="returnModal">
    <div class="modal">
      <div class="modal-header">
        <h2 id="modalTitle">Request #...</h2>
        <button onclick="closeModal()" style="border:none;background:none;font-size:1.5rem;cursor:pointer;">&times;</button>
      </div>
      
      <div id="modalContent">
        <div class="detail-row">
            <span class="detail-label">Customer:</span>
            <span class="detail-value" id="mCustomer">...</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Product:</span>
            <span class="detail-value" id="mProduct">...</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Refund Amount:</span>
            <span class="detail-value" id="mAmount">...</span>
        </div>

        <div class="reason-box">
            <div class="reason-title">Reason for Return</div>
            <p id="mReason" style="font-size:0.9rem; line-height:1.5; color:#333;">...</p>
        </div>
      </div>

      <div class="modal-actions" id="actionButtons">
        <button class="btn-approve" onclick="processReturn('Approved')">Approve Refund</button>
        <button class="btn-reject" onclick="processReturn('Rejected')">Reject Request</button>
      </div>
    </div>
  </div>

  <script>
    // --- MOCK DATA ---
    let returns = JSON.parse(localStorage.getItem('britium_returns')) || [
      { id: "RET-1008", date: "2025-01-24", customer: "Sue Sharp", product: "Sneakers (Size 38)", amount: 45000, reason: "Wrong item sent. I ordered size 39 but received 38.", status: "Approved" },
      { id: "RET-1006", date: "2025-01-23", customer: "Liam Burns", product: "Black Hoodie", amount: 25000, reason: "The fabric quality is not what I expected.", status: "Pending" },
      { id: "RET-1005", date: "2025-01-22", customer: "Matt Matteo", product: "Travel Backpack", amount: 65000, reason: "Changed my mind, found a cheaper option.", status: "Rejected" },
      { id: "RET-1004", date: "2025-01-21", customer: "Jasse Hundit", product: "Gold Chain", amount: 120000, reason: "Clasp is broken upon arrival.", status: "Pending" },
    ];

    let currentReturnId = null;

    // --- RENDER TABLE ---
    function renderTable() {
      const tbody = document.getElementById("tableBody");
      const search = document.getElementById("searchInput").value.toLowerCase();
      const statusFilter = document.getElementById("statusFilter").value;

      tbody.innerHTML = "";

      returns.forEach(r => {
        // Filter Logic
        if (
          !r.id.toLowerCase().includes(search) && 
          !r.customer.toLowerCase().includes(search) &&
          !r.product.toLowerCase().includes(search)
        ) return;

        if (statusFilter && r.status !== statusFilter) return;

        // Badge Logic
        let badgeClass = "status-pending";
        if(r.status === "Approved") badgeClass = "status-approved";
        if(r.status === "Rejected") badgeClass = "status-rejected";

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td><strong>${r.id}</strong></td>
          <td>${r.date}</td>
          <td>${r.customer}</td>
          <td>${r.product}</td>
          <td>${r.amount.toLocaleString()} MMK</td>
          <td><span class="status-badge ${badgeClass}">${r.status}</span></td>
          <td style="text-align:right">
            <button class="action-btn" onclick="openModal('${r.id}')">View Details</button>
          </td>
        `;
        tbody.appendChild(tr);
      });

      localStorage.setItem('britium_returns', JSON.stringify(returns));
    }

    // --- MODAL FUNCTIONS ---
    function openModal(id) {
      const r = returns.find(x => x.id === id);
      if(!r) return;

      currentReturnId = id;

      document.getElementById('modalTitle').innerText = `Request ${r.id}`;
      document.getElementById('mCustomer').innerText = r.customer;
      document.getElementById('mProduct').innerText = r.product;
      document.getElementById('mAmount').innerText = r.amount.toLocaleString() + " MMK";
      document.getElementById('mReason').innerText = r.reason;

      // Toggle buttons based on status
      const actionDiv = document.getElementById('actionButtons');
      if(r.status === "Pending") {
          actionDiv.style.display = "flex";
      } else {
          actionDiv.style.display = "none"; // Hide buttons if already processed
      }

      document.getElementById('returnModal').style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('returnModal').style.display = 'none';
    }

    function processReturn(newStatus) {
      if(!currentReturnId) return;

      if(confirm(`Are you sure you want to mark this as ${newStatus}?`)) {
        const index = returns.findIndex(r => r.id === currentReturnId);
        if(index > -1) {
            returns[index].status = newStatus;
            renderTable();
            closeModal();
        }
      }
    }

    function logout() {
      if(confirm("Logout?")) {
        localStorage.removeItem("britium_admin_session");
        window.location.href = "../admin-login.html";
      }
    }

    // Listeners
    document.getElementById('searchInput').addEventListener('keyup', renderTable);

    // Init
    renderTable();

  </script>
</body>
</html>
