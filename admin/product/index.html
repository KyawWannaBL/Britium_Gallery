<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Products | Britium Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Jost:wght@400;500;600&display=swap" rel="stylesheet">
  
  <style>
    /* --- RESET & LAYOUT --- */
    body { margin:0; font-family:'Inter', sans-serif; background:#f8fafc; color:#0f172a; display:flex; }
    
    /* --- SIDEBAR (Built-in) --- */
    .sidebar { width: 260px; background: #141414; color: #fff; height: 100vh; position: fixed; left: 0; top: 0; padding: 25px; box-sizing: border-box; display: flex; flex-direction: column; z-index: 100; }
    .sidebar h2 { color: #c6a87c; text-align: center; margin-bottom: 40px; font-family: 'Jost', sans-serif; letter-spacing: 1px; }
    .nav-link { display: block; padding: 12px 15px; color: #aaa; text-decoration: none; margin-bottom: 5px; border-radius: 8px; transition: 0.2s; font-size: 0.95rem; }
    .nav-link:hover, .nav-link.active { background: #333; color: #fff; }
    .nav-link.active { border-left: 3px solid #c6a87c; }
    .mt-auto { margin-top: auto; }

    /* --- MAIN CONTENT --- */
    main.main-content { margin-left: 260px; padding: 40px; width: 100%; box-sizing: border-box; }
    
    h1 { font-size:1.8rem; margin:0 0 5px 0; font-family: 'Jost', sans-serif; }
    .muted { color:#64748b; margin-bottom: 30px; font-size: 0.9rem; }

    .panel { background:#ffffff; border-radius:12px; padding:25px; border:1px solid #e2e8f0; box-shadow:0 4px 6px -1px rgba(0,0,0,0.05); }

    /* --- TOP BAR --- */
    .top-actions { display:flex; justify-content:space-between; margin-bottom:20px; }
    .search-box input { padding:10px 15px; border-radius:8px; border:1px solid #cbd5e1; width:300px; outline:none; }
    .btn-primary { background:#0f172a; color:#fff; border:none; padding:10px 20px; border-radius:8px; font-weight:600; cursor:pointer; transition:0.2s; }
    .btn-primary:hover { background:#334155; }

    /* --- TABLE --- */
    table { width:100%; border-collapse:collapse; font-size:0.9rem; }
    th { text-align:left; padding:12px; border-bottom:1px solid #e2e8f0; color:#64748b; font-size:0.8rem; text-transform:uppercase; letter-spacing:0.05em; }
    td { padding:16px 12px; border-bottom:1px solid #f1f5f9; vertical-align:middle; }
    
    .product-info { display:flex; align-items:center; gap:15px; }
    .product-thumb { width:48px; height:48px; border-radius:6px; object-fit:cover; background:#f1f5f9; border:1px solid #e2e8f0; }
    .product-name { font-weight:600; color:#0f172a; display: block; }
    .product-sku { font-size: 0.75rem; color: #64748b; }

    .status-badge { padding:4px 10px; border-radius:20px; font-size:0.75rem; font-weight:600; }
    .status-active { background:#dcfce7; color:#166534; }
    .status-low { background:#fef3c7; color:#92400e; }
    .status-out { background:#fee2e2; color:#991b1b; }

    .action-btn { background:none; border:none; cursor:pointer; color:#6366f1; font-weight:600; font-size:0.85rem; padding: 5px 10px; }
    .action-btn:hover { text-decoration: underline; }
    .action-btn.delete { color: #ef4444; }

    /* --- MODAL (POPUP) --- */
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000; }
    .modal { background: #fff; width: 500px; max-width: 90%; padding: 30px; border-radius: 12px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .modal-header h2 { margin: 0; font-size: 1.25rem; }
    .close-modal { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #64748b; }

    .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    .form-group { margin-bottom: 15px; }
    .form-group.full { grid-column: span 2; }
    
    label { display: block; font-size: 0.85rem; margin-bottom: 5px; font-weight: 500; color: #334155; }
    input, textarea, select { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; box-sizing: border-box; font-family: inherit; }
    textarea { resize: vertical; min-height: 80px; }

    .image-preview { width: 100%; height: 150px; background: #f8fafc; border: 2px dashed #cbd5e1; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-top: 5px; overflow: hidden; position: relative; }
    .image-preview img { width: 100%; height: 100%; object-fit: contain; }
    .image-preview span { color: #94a3b8; pointer-events: none; }
    .file-input { position: absolute; width: 100%; height: 100%; opacity: 0; cursor: pointer; }

    .modal-footer { margin-top: 25px; display: flex; justify-content: flex-end; gap: 10px; }
    .btn-cancel { background: #fff; border: 1px solid #cbd5e1; padding: 10px 20px; border-radius: 6px; cursor: pointer; }
  </style>

  <script>
    const session = localStorage.getItem("britium_admin_session");
    if (!session) window.location.href = "../admin-login.html";
  </script>
</head>

<body>

  <div class="sidebar">
    <h2>BRITIUM ADMIN</h2>
    <a href="dashboard/index.html" class="nav-link">Dashboard</a>
    
    <a href="orders.html" class="nav-link">Orders</a>
    
    <a href="products.html" class="nav-link active">Products</a>
    
    <a href="customers.html" class="nav-link">Customers</a>
    <a href="reports.html" class="nav-link">Analytics</a>
    <a href="staff.html" class="nav-link">Staff</a>
    
    <a href="#" class="nav-link mt-auto" onclick="logout()">Logout</a>
  </div>

  <main class="main-content">
    <h1>Product Management</h1>
    <p class="muted">Add, edit prices, and manage advertisement wording.</p>

    <div class="panel">
      <div class="top-actions">
        <div class="search-box">
          <input type="text" id="searchInput" placeholder="Search by name or SKU...">
        </div>
        <button class="btn-primary" onclick="openModal()">+ Add New Product</button>
      </div>

      <table>
        <thead>
          <tr>
            <th>Product Details</th>
            <th>Price (MMK)</th>
            <th>Stock</th>
            <th>Status</th>
            <th style="text-align:right">Actions</th>
          </tr>
        </thead>
        <tbody id="productTableBody">
          </tbody>
      </table>
    </div>
  </main>

  <div class="modal-overlay" id="productModal">
    <div class="modal">
      <div class="modal-header">
        <h2 id="modalTitle">Add Product</h2>
        <button class="close-modal" onclick="closeModal()">&times;</button>
      </div>
      
      <form id="productForm">
        <input type="hidden" id="editId">
        
        <div class="form-group full">
          <label>Product Image</label>
          <div class="image-preview" id="imagePreviewBox">
             <img id="previewImg" style="display:none">
             <span id="previewText">Click to upload image</span>
             <input type="file" id="imageInput" class="file-input" accept="image/*">
          </div>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>Product Name</label>
            <input id="pName" required placeholder="e.g. Luxury Tote">
          </div>
          <div class="form-group">
            <label>SKU Code</label>
            <input id="pSku" required placeholder="e.g. BG-101">
          </div>
          <div class="form-group">
            <label>Price (MMK)</label>
            <input id="pPrice" type="number" required placeholder="e.g. 450000">
          </div>
          <div class="form-group">
            <label>Stock Quantity</label>
            <input id="pStock" type="number" required placeholder="e.g. 10">
          </div>
        </div>

        <div class="form-group full">
          <label>Advertisement Caption / Wording</label>
          <textarea id="pCaption" placeholder="Write catchy marketing copy here..."></textarea>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn-cancel" onclick="closeModal()">Cancel</button>
          <button type="submit" class="btn-primary">Save Product</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // --- MOCK DATA SETUP ---
    let products = JSON.parse(localStorage.getItem('britium_products')) || [
      { id: 1, name: "Luxury Leather Tote", sku: "BG-1001", price: 480000, stock: 32, caption: "Timeless elegance.", img: "" },
      { id: 2, name: "Classic Shoulder Bag", sku: "BG-1002", price: 325000, stock: 4, caption: "Perfect for daily use.", img: "" },
    ];

    let currentImageBase64 = "";

    // --- RENDER FUNCTION ---
    function renderTable() {
      const tbody = document.getElementById('productTableBody');
      const filter = document.getElementById('searchInput').value.toLowerCase();
      tbody.innerHTML = '';

      products.forEach(p => {
        if (!p.name.toLowerCase().includes(filter) && !p.sku.toLowerCase().includes(filter)) return;

        let statusBadge = '<span class="status-badge status-active">Active</span>';
        if (p.stock === 0) statusBadge = '<span class="status-badge status-out">Out of Stock</span>';
        else if (p.stock < 10) statusBadge = '<span class="status-badge status-low">Low Stock</span>';

        const imgHtml = p.img 
          ? `<img src="${p.img}" class="product-thumb">` 
          : `<div class="product-thumb" style="display:flex;align-items:center;justify-content:center;color:#ccc;font-size:10px;">NO IMG</div>`;

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>
            <div class="product-info">
              ${imgHtml}
              <div>
                <span class="product-name">${p.name}</span>
                <span class="product-sku">${p.sku}</span>
              </div>
            </div>
          </td>
          <td>${parseInt(p.price).toLocaleString()}</td>
          <td>${p.stock}</td>
          <td>${statusBadge}</td>
          <td style="text-align:right">
            <button class="action-btn" onclick="editProduct(${p.id})">Edit</button>
            <button class="action-btn delete" onclick="deleteProduct(${p.id})">Delete</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      
      localStorage.setItem('britium_products', JSON.stringify(products));
    }

    // --- IMAGE UPLOAD HANDLING ---
    document.getElementById('imageInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onloadend = function() {
          currentImageBase64 = reader.result;
          document.getElementById('previewImg').src = currentImageBase64;
          document.getElementById('previewImg').style.display = 'block';
          document.getElementById('previewText').style.display = 'none';
        }
        reader.readAsDataURL(file);
      }
    });

    // --- MODAL FUNCTIONS ---
    function openModal() {
      document.getElementById('productForm').reset();
      document.getElementById('editId').value = "";
      document.getElementById('modalTitle').innerText = "Add New Product";
      currentImageBase64 = "";
      document.getElementById('previewImg').style.display = 'none';
      document.getElementById('previewText').style.display = 'block';
      document.getElementById('productModal').style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('productModal').style.display = 'none';
    }

    function editProduct(id) {
      const p = products.find(x => x.id === id);
      if (!p) return;

      document.getElementById('editId').value = p.id;
      document.getElementById('pName').value = p.name;
      document.getElementById('pSku').value = p.sku;
      document.getElementById('pPrice').value = p.price;
      document.getElementById('pStock').value = p.stock;
      document.getElementById('pCaption').value = p.caption || "";
      document.getElementById('modalTitle').innerText = "Edit Product";

      currentImageBase64 = p.img || "";
      if (currentImageBase64) {
        document.getElementById('previewImg').src = currentImageBase64;
        document.getElementById('previewImg').style.display = 'block';
        document.getElementById('previewText').style.display = 'none';
      } else {
        document.getElementById('previewImg').style.display = 'none';
        document.getElementById('previewText').style.display = 'block';
      }

      document.getElementById('productModal').style.display = 'flex';
    }

    function deleteProduct(id) {
      if(confirm("Are you sure you want to delete this product?")) {
        products = products.filter(p => p.id !== id);
        renderTable();
      }
    }

    function logout() {
      if(confirm("Logout?")) {
        localStorage.removeItem("britium_admin_session");
        window.location.href = "../admin-login.html";
      }
    }

    document.getElementById('productForm').addEventListener('submit', (e) => {
      e.preventDefault();
      
      const id = document.getElementById('editId').value;
      const newProduct = {
        id: id ? parseInt(id) : Date.now(),
        name: document.getElementById('pName').value,
        sku: document.getElementById('pSku').value,
        price: document.getElementById('pPrice').value,
        stock: document.getElementById('pStock').value,
        caption: document.getElementById('pCaption').value,
        img: currentImageBase64
      };

      if (id) {
        const index = products.findIndex(p => p.id == id);
        products[index] = newProduct;
      } else {
        products.push(newProduct);
      }

      closeModal();
      renderTable();
    });

    document.getElementById('searchInput').addEventListener('keyup', renderTable);

    // Initial Load
    renderTable();

  </script>
</body>
</html>
